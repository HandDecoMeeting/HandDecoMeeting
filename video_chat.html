<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    
    <script
    type="text/javascript"
    src="/socket.io/socket.io.js"
    ></script>
  
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    
    <title>손꾸팅</title>
    <py-env>
    - opencv-python
    - paths:
      - http://dreamplan7.cafe24.com/pyscript/pixabay-6387.mp4
    </py-env>
    <py-config>
      - autoclose_loader: true
      - runtimes:
        -
          src: "https://cdn.jsdelivr.net/pyodide/dev/full/pyodide.js"
          name: pyodide-0.20
          lang: python
    </py-config>
  </head>
  <!-- <py-config type="toml">
    paths = ["./test.py"]
  </py-config> -->

  <body>
    프레임번호 : <span id="frameNo"></span>
    <canvas id="view" width=1280 height=720></canvas>
    <div id="pyscript">
<py-script>
import cv2
from js import document, setInterval, \
  setTimeout, ImageData, Uint8ClampedArray, \
  CanvasRenderingContext2D as Context2d
from pyodide.ffi import create_proxy, to_js
import asyncio
import gc
import numpy as np


캡쳐 = cv2.VideoCapture('pixabay-6387.mp4')

프레임번호 = 0
canvas = document.getElementById("view")
ctx = canvas.getContext("2d")

def draw_image(ctx, x, y, image):
  data = Uint8ClampedArray.new(to_js(image.tobytes()))
  height, width, _ = image.shape
  image_data = ImageData.new(data, width, height)
  ctx.putImageData(image_data, 0, 0, x, y, width, height)

def ShowFrame():
  global 캡쳐, 그래프, cv2, 프레임번호, document
  캡쳐.set(cv2.CAP_PROP_POS_FRAMES, 프레임번호)
  ret, frame = 캡쳐.read() # 두 개의 값을 반환하므로 두 변수 지정
  
  reverse = cv2.cvtColor(frame, cv2.COLOR_BGR2RGBA)
  
  
  draw_image(ctx, 0, 0, reverse)
  document.getElementById('frameNo').innerHTML=프레임번호
  프레임번호=프레임번호+10
  gc.collect()
  setTimeout(ShowFrameProxy, 0)

ShowFrameProxy = create_proxy(ShowFrame)
setTimeout(ShowFrameProxy, 0)
</py-script>


    </div>
    <h1>AR-Note via WebRTC</h1>

    <div style="display: flex; flex-direction: column">
      <!-- <py-button id="pyscript-click" onClick="test">test</py-button> -->
      <h1 id="myInfo">My Screen</h1>
      <video
        id="localVideo"
        autoplay
        style="width: 700px; height: 500px"
      ></video>

      <h1>Other Screen</h1>
      <!-- <video
        id="remoteVideo"
        autoplay
        style="width: 700px; height: 500px; background: rgba(0, 0, 0, 0.5)"
      ></video> -->

      <div id="call_container" style="display: flex"></div>

      <div id="incoming_call"></div>

      <div id="video_container"></div>

    </div>

    <script src="new.js"></script>
  </body>
</html>
